#!/usr/bin/env node
const chalk = require('chalk');
const path = require('path');
const { Form } = require('..');

const { argv } = require('yargs')
	.command(
		'* <source> [-m map] [-f filler] [-i input] [-o output]',
		'Fill a PDF form.',
		(yargs) => {
			yargs.positional('source', {
				describe: 'The PDF file to fill.',
				type: 'string',
				required: true
			}).option(
				'config', {
					alias: 'f',
					description: 'The config file.',
					required: true
				}
			).option(
				'map', {
					alias: 'm',
					description: 'The map file.',
					required: true
				}
			).option(
				'script', {
					alias: 's',
					description: 'The form filler script.',
					required: true
				}
			).option(
				'output', {
					alias: 'o',
					description: 'The output file.',
					default: 'output.pdf'
				}
			).alias(
				'v', 'version'
			).alias(
				'h', 'help'
			)
		}
	)
	.help()
	.strict();

const form = new Form();
const formName = path.basename(argv.source, '.pdf');

form.init(formName, argv.map, argv.config)
	.then(() => form.fill(argv.script))
	.then(() => form.save(argv.source, argv.output))
	.then((result) => {
		console.log('Done');
	})
	.catch((err) => {
		console.error(err);
		process.exit(-1);
	});


// // pdfFile, mapFile, configFile, fillerFile
// engine.fillForm(argv.source, argv.map, argv.config, argv.script, {
// 	output: argv.output
// })
// .then(result => {
// 	console.log(`\
// Done\
// `);
// }).catch(err => {
// 	console.error(err);
// });
